<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podsjetnik za lijekove</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* Osnovna stilizacija */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s, color 0.5s;
        }

        /* Osnovna tamna tema */
        body.dark {
            background-color: #111827;
            color: #e5e7eb;
        }

        /* Card animacije */
        .card-container {
            opacity: 0;
            transform: translateY(20px);
            animation: fade-in 0.5s forwards;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
        }

        .card-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Animacija za pojavljivanje elemenata */
        @keyframes fade-in {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Stanje kada je lijek uzet */
        .card-container.taken {
            background-color: #d1d5db; /* Svjetlo siva u svijetlom modu */
            opacity: 0.6;
        }

        body.dark .card-container.taken {
            background-color: #374151; /* Tamno siva u tamnom modu */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-500 font-sans">

    <!-- Kontejner za prijavu/registraciju -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-sm transform transition duration-500 hover:scale-105">
            <h1 id="auth-title" class="text-3xl font-bold text-center text-gray-800 dark:text-white mb-6"></h1>
            
            <!-- Prebacivanje između Prijava i Registracija -->
            <div class="flex justify-center mb-6">
                <button id="auth-toggle-btn" class="text-indigo-600 dark:text-indigo-400 font-medium hover:underline transition-colors"></button>
            </div>
            
            <form id="auth-form" class="space-y-4">
                <div>
                    <input type="email" id="email-input" placeholder="Email" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <div>
                    <input type="password" id="password-input" placeholder="Lozinka" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <button type="submit" id="auth-submit-btn" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                    <span id="auth-submit-text"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Glavni kontejner aplikacije -->
    <div id="app-container" class="container mx-auto p-4 hidden">
        <header class="flex justify-between items-center py-4 border-b border-gray-300 dark:border-gray-700">
            <h1 id="main-title" class="text-3xl font-bold text-gray-800 dark:text-white"></h1>
            <div class="flex items-center space-x-4">
                <button id="add-medicine-btn" class="bg-indigo-600 text-white p-2 rounded-full shadow-lg hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-plus"></i>
                </button>
                <button id="dark-mode-toggle" class="p-2 rounded-full text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="relative">
                    <select id="language-selector" class="bg-transparent text-gray-800 dark:text-white appearance-none p-2 rounded-lg cursor-pointer">
                        <option value="hr">HR</option>
                        <option value="en">EN</option>
                    </select>
                </div>
                <button id="logout-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors">Odjava</button>
            </div>
        </header>
        
        <main class="mt-8">
            <p id="no-medicines-text" class="text-center text-gray-500 dark:text-gray-400 font-medium text-lg hidden"></p>
            <div id="medicines-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Lijekovi će biti dinamički dodani ovdje -->
            </div>
        </main>
    </div>

    <!-- Modal za dodavanje/uređivanje lijeka -->
    <div id="add-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md transform transition-transform duration-300 scale-95">
            <h2 id="modal-title" class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Dodaj lijek</h2>
            <form id="medicine-form" class="space-y-4">
                <div>
                    <label for="medicine-name-input" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Naziv lijeka</label>
                    <input type="text" id="medicine-name-input" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <div>
                    <label for="medicine-type-input" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Vrsta lijeka</label>
                    <select id="medicine-type-input" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                        <option value="tableta">Tableta</option>
                        <option value="sirup">Sirup</option>
                        <option value="sprej">Sprej</option>
                        <option value="injekcija">Injekcija</option>
                    </select>
                </div>
                <div>
                    <label for="medicine-times-input" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Koliko puta dnevno (puta odvojena zarezom)</label>
                    <input type="text" id="medicine-times-input" placeholder="npr. 8:00, 12:30, 18:00" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <div>
                    <label for="start-date-input" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Datum početka</label>
                    <input type="date" id="start-date-input" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <div>
                    <label for="end-date-input" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Datum završetka</label>
                    <input type="date" id="end-date-input" required
                        class="w-full px-4 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                </div>
                <div class="flex justify-end space-x-2 mt-4">
                    <button id="cancel-button" type="button" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white rounded-lg font-semibold hover:bg-gray-400 dark:hover:bg-gray-600 transition-colors">Odustani</button>
                    <button id="save-button" type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Spremi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Prilagođeni modal za poruke -->
    <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-xs text-center">
            <p id="custom-modal-message" class="text-gray-800 dark:text-gray-200 mb-4"></p>
            <div class="flex justify-center space-x-4">
                <button id="custom-modal-ok" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">OK</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, deleteDoc, setDoc, getDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase konfiguracija (izvučeno iz firebase-config.js)
        const firebaseConfig = {
            apiKey: "AIzaSyATA5Nzgo7cWQrpuUmVb3dKtpuax0I8u78",
            authDomain: "pillreminderapp-5001d.firebaseapp.com",
            projectId: "pillreminderapp-5001d",
            storageBucket: "pillreminderapp-5001d.firebasestorage.app",
            messagingSenderId: "284598567632",
            appId: "1:284598567632:web:93c30c46f208293e6dd4d5"
        };
        
        // Inicijalizacija Firebase-a
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Dohvaćanje DOM elemenata
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const authTitle = document.getElementById('auth-title');
        const authForm = document.getElementById('auth-form');
        const emailInput = document.getElementById('email-input');
        const passwordInput = document.getElementById('password-input');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authSubmitText = document.getElementById('auth-submit-text');
        const authToggleBtn = document.getElementById('auth-toggle-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const addModal = document.getElementById('add-modal');
        const addMedicineBtn = document.getElementById('add-medicine-btn');
        const cancelButton = document.getElementById('cancel-button');
        const medicineForm = document.getElementById('medicine-form');
        const medicinesList = document.getElementById('medicines-list');
        const noMedicinesText = document.getElementById('no-medicines-text');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const languageSelector = document.getElementById('language-selector');

        // Modali za poruke
        const customModal = document.getElementById('custom-modal');
        const customModalMessage = document.getElementById('custom-modal-message');
        const customModalOk = document.getElementById('custom-modal-ok');
        
        // Stanje aplikacije
        let isLogin = true;
        let currentLanguage = localStorage.getItem('language') || 'hr';

        // Definiranje tipova za lijekove
        const medicineTypes = {
            'tableta': '💊',
            'sirup': '🧴',
            'sprej': '👃',
            'injekcija': '💉'
        };

        // Objekti za prijevod
        const translations = {
            hr: {
                mainTitle: 'Moji lijekovi',
                noMedicinesText: 'Još nema dodanih lijekova. Dodaj novi podsjetnik!',
                authTitleLogin: 'Prijava',
                authTitleRegister: 'Registracija',
                authToggleLogin: 'Nemate račun? Registrirajte se',
                authToggleRegister: 'Već imate račun? Prijavite se',
                authSubmitLogin: 'Prijavi se',
                authSubmitRegister: 'Registriraj se',
                modalTitleAdd: 'Dodaj lijek',
                modalTitleEdit: 'Uredi lijek',
                errorSave: 'Greška pri spremanju:',
                errorDelete: 'Greška pri brisanju:',
                errorFetch: 'Greška pri dohvaćanju lijekova:',
                errorAuth: 'Greška u autentifikaciji:',
                successLogout: 'Uspješno ste se odjavili.',
                deleteConfirm: 'Jeste li sigurni da želite obrisati ovaj lijek?',
                errorFirebase: {
                    'auth/invalid-email': 'Neispravan format e-maila.',
                    'auth/wrong-password': 'Pogrešna lozinka.',
                    'auth/user-not-found': 'Korisnik nije pronađen.',
                    'auth/email-already-in-use': 'E-mail je već u upotrebi.',
                    'auth/weak-password': 'Lozinka mora imati najmanje 6 znakova.',
                    'auth/invalid-credential': 'Neispravne vjerodajnice.',
                    'default': 'Došlo je do greške. Pokušajte ponovo.'
                }
            },
            en: {
                mainTitle: 'My Medicines',
                noMedicinesText: 'No medicines added yet. Add a new reminder!',
                authTitleLogin: 'Sign In',
                authTitleRegister: 'Register',
                authToggleLogin: 'Don\'t have an account? Register',
                authToggleRegister: 'Already have an account? Sign In',
                authSubmitLogin: 'Sign In',
                authSubmitRegister: 'Register',
                modalTitleAdd: 'Add medicine',
                modalTitleEdit: 'Edit medicine',
                errorSave: 'Error saving:',
                errorDelete: 'Error deleting:',
                errorFetch: 'Error fetching medicines:',
                errorAuth: 'Authentication error:',
                successLogout: 'You have been successfully logged out.',
                deleteConfirm: 'Are you sure you want to delete this medicine?',
                errorFirebase: {
                    'auth/invalid-email': 'Invalid email format.',
                    'auth/wrong-password': 'Wrong password.',
                    'auth/user-not-found': 'User not found.',
                    'auth/email-already-in-use': 'Email is already in use.',
                    'auth/weak-password': 'Password must have at least 6 characters.',
                    'auth/invalid-credential': 'Invalid credentials.',
                    'default': 'An error occurred. Please try again.'
                }
            }
        };

        // Funkcija za prikaz prilagođenog modala s porukom
        function showCustomModal(message, isConfirm = false, onConfirm = null) {
            customModalMessage.textContent = message;
            customModal.style.display = 'flex';
            
            customModalOk.style.display = 'block';

            const handleOk = () => {
                customModal.style.display = 'none';
                customModalOk.removeEventListener('click', handleOk);
                if (isConfirm) {
                     // No-op, confirmation button is for show, not an actual action
                }
            };

            customModalOk.addEventListener('click', handleOk);
        }

        // Funkcija za ažuriranje teksta ovisno o jeziku
        function updateUIStrings() {
            const lang = translations[currentLanguage];
            authTitle.textContent = isLogin ? lang.authTitleLogin : lang.authTitleRegister;
            authToggleBtn.textContent = isLogin ? lang.authToggleLogin : lang.authToggleRegister;
            authSubmitText.textContent = isLogin ? lang.authSubmitLogin : lang.authSubmitRegister;
            document.getElementById('main-title').textContent = lang.mainTitle;
            document.getElementById('no-medicines-text').textContent = lang.noMedicinesText;
        }

        // Prebacivanje između Prijava i Registracija
        authToggleBtn.addEventListener('click', () => {
            isLogin = !isLogin;
            updateUIStrings();
        });

        // Rukovanje prijavom i registracijom
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            const lang = translations[currentLanguage];

            try {
                if (isLogin) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
            } catch (error) {
                // Prevođenje Firebase greške
                const errorMessage = lang.errorFirebase[error.code] || lang.errorFirebase['default'];
                showCustomModal(errorMessage);
            }
        });
        
        // Rukovanje odjavom
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showCustomModal(translations[currentLanguage].successLogout);
            } catch (error) {
                showCustomModal(`${translations[currentLanguage].errorAuth} ${error.message}`);
            }
        });

        // Praćenje promjena u stanju autentifikacije
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                // Ovdje bi išao poziv za učitavanje podataka lijekova (onSnapshot)
            } else {
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
        });

        // Slušatelj za tamni mod
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        });

        // Inicijalna provjera teme
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // Ažuriranje UI-a na početku
        updateUIStrings();
    </script>
</body>
</html>
